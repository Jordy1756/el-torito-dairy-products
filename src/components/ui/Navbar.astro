---
import CloseIcon from "@components/icons/Close.astro";
import Logo from "@components/icons/Logo.astro";
import MenuIcon from "@components/icons/Menu.astro";
import Link from "@components/ui/Link.astro";

import { basics } from "@data";

interface Props {
  popoverTargetId: string;
  isPopover?: boolean;
  className?: "open";
}

const { name } = basics;
const { isPopover, className, popoverTargetId } = Astro.props;
const pathname = Astro.url.pathname;

const menuItems = [
  { href: "/#", label: "Home", aria: `Ir a la página principal de ${name}` },
  {
    href: "/who-we-are#about-us",
    label: "Sobre Nosotros",
    aria: `Ir a la sección Sobre Nosotros de ${name}`,
    dataLink: "about-us",
  },
  {
    href: "/who-we-are#testimonies",
    label: "Testimonios",
    aria: `Ir a la sección Testimonios de ${name}`,
    dataLink: "testimonies",
  },
  {
    href: "/who-we-are#our-team",
    label: "Nuestro Equipo",
    aria: `Ir a la sección Nuestro Equipo de ${name}`,
    dataLink: "our-team",
  },
];

const menuActions = [
  {
    href: "/#products",
    label: "Productos",
    aria: `Ir a la sección Productos de ${name}`,
    variant: "primary",
  },
  {
    href: `${pathname}#contact-us`,
    label: "Contacto",
    aria: `Ir a la sección Contacto de ${name}`,
    variant: "secondary",
  },
];
---

<nav id={!isPopover ? "navbar" : null} class={className}>
  <div class="brand">
    <a href="/#" aria-label={`Ir a la página principal de ${name}`} title={`Ir a la página principal de ${name}`}>
      <Logo height={49} class="logo" />
    </a>
    {
      !isPopover ? (
        <button
          id="open-menu-btn"
          title="Abrir menú de navegación"
          aria-label="Abrir menú de navegación"
          popovertarget={popoverTargetId}
        >
          <MenuIcon width={32} class="menu__icon" />
        </button>
      ) : (
        <button
          id="close-menu-btn"
          title="Cerrar menú de navegación"
          aria-label="Cerrar menú de navegación"
          popovertarget={popoverTargetId}
          popovertargetaction="hide"
        >
          <CloseIcon width={24} class="close__icon" />
        </button>
      )
    }
  </div>
  {isPopover && <div class="separator" />}
  <div class="menu__container">
    <ul>
      {
        menuItems.map(({ href, label, aria, dataLink }) => (
          <li data-link={dataLink}>
            <Link href={href} aria-label={aria}>
              {label}
            </Link>
          </li>
        ))
      }
    </ul>
    <div>
      {
        menuActions.map(({ href, label, aria, variant }) => (
          <Link variant={variant as "primary" | "secondary"} href={href} aria-label={aria}>
            {label}
          </Link>
        ))
      }
    </div>
  </div>
</nav>

<style>
  nav {
    display: flex;
    justify-content: space-between;
    gap: 2rem;
    width: min(100%, var(--max-width));
    transition: transform 0.3s ease-in-out;
  }

  nav > .brand {
    display: flex;
    align-items: center;
    gap: 0.5rem;
  }

  nav > .brand > :is(button, a) {
    display: flex;
  }

  nav > .brand > a > .logo {
    object-fit: contain;
  }

  nav > .brand > a > .logo,
  nav > .brand > button > .menu__icon {
    color: light-dark(var(--neutral-900), var(--neutral-50));
  }

  nav:not(.open) > .brand > button {
    display: none;
  }

  nav > .menu__container {
    display: flex;
    align-items: center;
    gap: 1.5rem;
  }

  nav > .menu__container > :is(ul, div) {
    display: flex;
    align-items: center;
    gap: 1rem;
  }

  nav.open {
    height: 100%;
    flex-direction: column;
    gap: 1rem;
  }

  nav.open > .brand {
    justify-content: space-between;
  }

  nav > .separator {
    width: 100%;
    height: 1px;
    background-color: var(--neutral-200);
  }

  nav.open > .menu__container,
  nav.open > .menu__container > ul {
    flex-direction: column;
    align-items: flex-start;
  }

  nav.open > .menu__container {
    flex: 1;
    gap: 1rem;
  }

  nav.open > .menu__container > ul {
    flex: 1;
    gap: 0.5rem;
  }

  nav.open > .menu__container > div {
    width: 100%;
    gap: 0.5rem;
    flex-wrap: wrap;
  }

  nav.open > .menu__container > div > a {
    flex: 1;
  }

  @media (width < 874px) {
    nav:not(.open) > .brand > button {
      display: flex;
    }

    nav:not(.open) > .menu__container > ul {
      display: none;
    }
  }

  @media (width < 480px) {
    nav:not(.open) > .menu__container > div > a.secondary {
      display: none;
    }
  }
</style>
